import{e as O}from"./index.modern.CkIAsQri.js";function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},y.apply(this,arguments)}function T(e){return"title"!==e.localName&&!e.matches("[data-swup-theme]")}function A(e,t){return e.outerHTML===t.outerHTML}function P(e,t=[]){const s=Array.from(e.attributes);return t.length?s.filter((({name:e})=>t.some((t=>t instanceof RegExp?t.test(e):e===t)))):s}function j(e){return e.matches("link[rel=stylesheet][href]")}class k extends O{constructor(e={}){var t;super(),t=this,this.name="SwupHeadPlugin",this.requires={swup:">=4.6"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,attributes:["lang","dir"],timeout:3e3},this.options=void 0,this.updateHead=async function(e,{page:{}}){const{awaitAssets:s,attributes:n,timeout:r}=t.options,o=e.to.document,{removed:i,added:a}=function(e,t,{shouldPersist:s=()=>!1}={}){const n=Array.from(e.children),r=Array.from(t.children),o=(i=n,r.reduce(((e,t,s)=>(i.some((e=>A(t,e)))||e.push({el:t,index:s}),e)),[]));var i;const a=(u=r,n.reduce(((e,t)=>(u.some((e=>A(t,e)))||e.push({el:t}),e)),[]));var u;return a.reverse().filter((({el:e})=>T(e))).filter((({el:e})=>!s(e))).forEach((({el:t})=>e.removeChild(t))),o.filter((({el:e})=>T(e))).forEach((({el:t,index:s=0})=>{e.insertBefore(t.cloneNode(!0),e.children[s+1]||null)})),{removed:a.map((({el:e})=>e)),added:o.map((({el:e})=>e))}}(document.head,o.head,{shouldPersist:e=>t.isPersistentTag(e)});if(t.swup.log(`Removed ${i.length} / added ${a.length} tags in head`),null!=n&&n.length&&function(e,t,s=[]){const n=new Set;for(const{name:r,value:o}of P(t,s))e.setAttribute(r,o),n.add(r);for(const{name:t}of P(e,s))n.has(t)||e.removeAttribute(t)}(document.documentElement,o.documentElement,n),s){const e=function(e,t=0){return e.filter(j).map((e=>function(e,t=0){const s=t=>{e.sheet?t():setTimeout((()=>s(t)),10)};return new Promise((n=>{s((()=>n(e))),t>0&&setTimeout((()=>n(e)),t)}))}(e,t)))}(a,r);e.length&&(t.swup.log(`Waiting for ${e.length} assets to load`),await Promise.all(e))}},this.options=y({},this.defaults,e),this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(e){const{persistTags:t}=this.options;return"function"==typeof t?t(e):"string"==typeof t&&t.length>0?e.matches(t):!!t}}export{k as default};